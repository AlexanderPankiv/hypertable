#!/bin/bash

if [ $# -eq 0 ]; then
  echo "usage: $0 <ht-cluster-task>"
fi

ec2-describe-instances > /tmp/describe-instances.txt
IP=`hostname --ip-address`
INSTANCE=`fgrep $IP /tmp/describe-instances.txt | cut -f2 -d'	'`
MY_ROLE=`fgrep aws:elasticmapreduce:instance-group-role /tmp/describe-instances.txt | fgrep $INSTANCE | cut -f5 -d'	'`
rm -f /tmp/describe-instances.txt

if [ "$MY_ROLE" == "MASTER" ]; then
  for task in "$@" ; do
    sudo -u hadoop /opt/hypertable/current/bin/ht cluster $task
#    if [ $? -ne 0 ]; then
#      echo "Task '$task' failure."
#      exit 1
#    fi
  done
fi

exit 0
